<div class="container">
  <div *ngIf="currentStep === 'auth'" class="auth-wrapper content-fade">
    <section class="card">
      <div class="card-header">
        <h2 style="text-align: center;">{{ isLoginMode ? '–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' }}</h2>
      </div>
      <div class="card-body">
        <div *ngIf="errorMessage" class="error-banner">{{ errorMessage }}</div>
        <div class="input-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="user.email" placeholder="mail@example.com">
        </div>
        <div class="input-group">
          <label>–ü–∞—Ä–æ–ª—å</label>
          <input type="password" [(ngModel)]="user.password">
        </div>
        <button class="btn-save" (click)="handleAuth()">
          {{ isLoginMode ? '–í–æ–π—Ç–∏' : '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' }}
        </button>
        <button class="auth-toggle" (click)="isLoginMode = !isLoginMode; errorMessage = null">
          {{ isLoginMode ? '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è' : '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏' }}
        </button>
      </div>
    </section>
  </div>

  <div *ngIf="currentStep === 'setup'" class="setup-wrapper content-fade">
    <section class="card">
      <div class="card-header"><h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h2></div>
      <div class="card-body">
        <div class="input-group"><label>–í–∞—à–µ –∏–º—è</label><input [(ngModel)]="user.name"></div>
        <div class="row">
          <div class="input-group"><label>–†–æ—Å—Ç (—Å–º)</label><input type="number" [(ngModel)]="user.heightCm"></div>
          <div class="input-group"><label>–í–æ–∑—Ä–∞—Å—Ç</label><input type="number" [(ngModel)]="user.age"></div>
        </div>
        <div class="row">
          <div class="input-group"><label>–¢–µ–∫—É—â–∏–π –≤–µ—Å (–∫–≥)</label><input type="number" [(ngModel)]="user.startWeightKg" (ngModelChange)="updateAvailableGoals()"></div>
          <div class="input-group"><label>–¶–µ–ª–µ–≤–æ–π –≤–µ—Å (–∫–≥)</label><input type="number" [(ngModel)]="user.targetWeightKg" (ngModelChange)="updateAvailableGoals()"></div>
        </div>
        <div class="input-group">
          <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
          <select [(ngModel)]="user.activityLevel">
            <option value="SIT">–°–∏–¥—è—á–∏–π (x1.2)</option>
            <option value="LIGHT">–õ–µ–≥–∫–∏–π (x1.375)</option>
            <option value="MID">–°—Ä–µ–¥–Ω–∏–π (x1.55)</option>
          </select>
        </div>
        <div class="input-group">
          <label>–¢–µ–º–ø —Ü–µ–ª–∏ (–≤ –Ω–µ–¥–µ–ª—é)</label>
          <select [(ngModel)]="user.weeklyGoalKg">
            <option *ngFor="let g of availableGoals" [ngValue]="g.value">{{ g.label }}</option>
          </select>
        </div>
        <button class="btn-save" (click)="saveProfileData()">–ù–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</button>
      </div>
    </section>
  </div>

  <div *ngIf="currentStep === 'main'" class="content-fade">
    <header>
      <h1>Health <span>Tracker</span></h1>
      <button class="btn-logout" (click)="logout()">–í—ã–π—Ç–∏</button>
    </header>

    <nav class="tab-navigation">
      <button (click)="activeTab = 'diary'" [class.active]="activeTab === 'diary'">üçé –ï–¥–∞</button>
      <button (click)="activeTab = 'workout'" [class.active]="activeTab === 'workout'">üí™ –ó–∞–ª</button>
      <button (click)="activeTab = 'stats'" [class.active]="activeTab === 'stats'">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
      <button (click)="activeTab = 'profile'" [class.active]="activeTab === 'profile'">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
    </nav>

    <div *ngIf="activeTab === 'diary' || activeTab === 'workout'" class="date-selector card" style="padding: 12px; margin-bottom: 20px;">
      <input type="date" [(ngModel)]="selectedDate" (change)="onDateChange()">
    </div>

    <div *ngIf="activeTab === 'diary'" class="content-fade">
      <section class="card">
        <div class="card-header"><h3>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–µ–º –ø–∏—â–∏</h3></div>
        <div class="card-body">
          <div class="input-group"><input [(ngModel)]="foodInput.description" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞"></div>
          <div class="row">
            <div class="input-group"><label>–ö–∫–∞–ª / 100–≥</label><input type="number" [(ngModel)]="foodInput.caloriesPer100g"></div>
            <div class="input-group"><label>–í–µ—Å (–≥)</label><input type="number" [(ngModel)]="foodInput.portionSizeGrams"></div>
          </div>
          <div class="row">
            <div class="input-group"><label>–ë–µ–ª–∫–∏</label><input type="number" [(ngModel)]="foodInput.proteinPer100g"></div>
            <div class="input-group"><label>–ñ–∏—Ä—ã</label><input type="number" [(ngModel)]="foodInput.fatsPer100g"></div>
            <div class="input-group"><label>–£–≥–ª.</label><input type="number" [(ngModel)]="foodInput.carbsPer100g"></div>
          </div>
          <button class="btn-save" (click)="addFood()">–ó–∞–ø–∏—Å–∞—Ç—å –≤ –¥–Ω–µ–≤–Ω–∏–∫</button>
        </div>
      </section>

      <section class="card" *ngIf="dailyFoodLogs.length > 0">
        <div class="card-header"><h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h3></div>
        <div class="history-list">
          <div class="history-item" *ngFor="let item of dailyFoodLogs">
            <div class="item-info">
              <span class="item-name">{{ item.description }}</span>
              <span class="item-meta">{{ item.portionSizeGrams }}–≥</span>
            </div>
            <div class="item-actions">
              <span class="item-kcal"><strong>{{ item.calories }}</strong> –∫–∫–∞–ª</span>
              <button class="btn-delete-small" (click)="deleteFoodLog(item.foodId)">‚úï</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div *ngIf="activeTab === 'workout'" class="content-fade">
      <section class="card">
        <div class="card-header"><h3>–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</h3></div>
        <div class="card-body">
          <div class="input-group"><label>–í–∏–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</label><input [(ngModel)]="workoutInput.type" placeholder="–ù–∞–ø—Ä. –ë–µ–≥"></div>
          <div class="row">
            <div class="input-group"><label>–í—Ä–µ–º—è (–º–∏–Ω)</label><input type="number" [(ngModel)]="workoutInput.durationMinutes"></div>
            <div class="input-group"><label>–ö–∫–∞–ª / –º–∏–Ω</label><input type="number" [(ngModel)]="workoutInput.caloriesBurnedPerMinute"></div>
          </div>
          <div class="calc-preview" *ngIf="workoutInput.durationMinutes > 0 && workoutInput.caloriesBurnedPerMinute > 0">
            –ë—É–¥–µ—Ç —Å–æ–∂–∂–µ–Ω–æ: <strong>{{ workoutInput.durationMinutes * workoutInput.caloriesBurnedPerMinute }}</strong> –∫–∫–∞–ª
          </div>
          <button class="btn-save" (click)="addWorkout()">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
        </div>
      </section>
      
      <section class="card" *ngIf="dailyWorkoutLogs.length > 0">
        <div class="card-header"><h3>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –¥–µ–Ω—å</h3></div>
        <div class="history-list">
          <div class="history-item" *ngFor="let w of dailyWorkoutLogs">
            <div class="item-info">
              <span class="item-name">{{ w.type }}</span>
              <span class="item-meta">{{ w.durationMinutes }} –º–∏–Ω</span>
            </div>
            <div class="item-actions">
              <span class="item-kcal burned"><strong>-{{ w.caloriesBurned }}</strong> –∫–∫–∞–ª</span>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div *ngIf="activeTab === 'stats'" class="content-fade">
      <section class="card summary-card" *ngIf="goal">
        <div class="kcal-grid">
          <div class="kcal-item"><span class="label">–¶–ï–õ–¨</span><strong>{{ goal.targetIntakeKcal }}</strong></div>
          <div class="operator">-</div>
          <div class="kcal-item"><span class="label">–ï–î–ê</span><strong>{{ goal.currentIntakeKcal }}</strong></div>
          <div class="operator">+</div>
          <div class="kcal-item"><span class="label">–£–ü–†.</span><strong>{{ goal.currentBurnedKcal }}</strong></div>
          <div class="operator">=</div>
          <div class="kcal-item highlight">
            <strong>{{ remainingKcal }}</strong>
            <span class="label">–û–°–¢–ê–¢–û–ö</span>
          </div>
        </div>
        <div class="progress-container main-progress">
          <div class="progress-bar bg-calories" 
               [style.width.%]="kcalPercent" 
               [class.over-limit]="remainingKcal < 0">
          </div>
        </div>
      </section>

      <section class="card" *ngIf="goal">
        <div class="card-header"><h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ë–ñ–£</h3></div>
        <div class="card-body">
          <div class="macro-item">
            <div class="macro-header">
              <span>ü•© –ë–µ–ª–∫–∏</span>
              <span>{{ goal.currentProteinGrams }}–≥ / {{ goal.proteinGrams }}–≥</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar bg-protein" [style.width.%]="proteinPercent"></div>
            </div>
          </div>
          <div class="macro-item">
            <div class="macro-header">
              <span>ü•ë –ñ–∏—Ä—ã</span>
              <span>{{ goal.currentFatsGrams }}–≥ / {{ goal.fatsGrams }}–≥</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar bg-fats" [style.width.%]="fatsPercent"></div>
            </div>
          </div>
          <div class="macro-item">
            <div class="macro-header">
              <span>üçû –£–≥–ª–µ–≤–æ–¥—ã</span>
              <span>{{ goal.currentCarbsGrams }}–≥ / {{ goal.carbsGrams }}–≥</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar bg-carbs" [style.width.%]="carbsPercent"></div>
            </div>
          </div>
        </div>
        <div class="goal-desc-footer">{{ goal.goalDescription }}</div>
      </section>
    </div>

    <div *ngIf="activeTab === 'profile'" class="content-fade">
      <section class="card">
        <div class="card-header"><h3>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3></div>
        <div class="card-body">
          <div class="input-group"><label>–ò–º—è</label><input [(ngModel)]="user.name"></div>
          <div class="row">
            <div class="input-group"><label>–†–æ—Å—Ç (—Å–º)</label><input type="number" [(ngModel)]="user.heightCm"></div>
            <div class="input-group"><label>–í–æ–∑—Ä–∞—Å—Ç</label><input type="number" [(ngModel)]="user.age"></div>
          </div>
          <div class="row">
            <div class="input-group"><label>–¢–µ–∫—É—â–∏–π –≤–µ—Å (–∫–≥)</label><input type="number" [(ngModel)]="user.startWeightKg" (ngModelChange)="updateAvailableGoals()"></div>
            <div class="input-group"><label>–¶–µ–ª–µ–≤–æ–π –≤–µ—Å (–∫–≥)</label><input type="number" [(ngModel)]="user.targetWeightKg" (ngModelChange)="updateAvailableGoals()"></div>
          </div>
          <div class="input-group">
            <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
            <select [(ngModel)]="user.activityLevel">
              <option value="SIT">–°–∏–¥—è—á–∏–π (x1.2)</option>
              <option value="LIGHT">–õ–µ–≥–∫–∏–π (x1.375)</option>
              <option value="MID">–°—Ä–µ–¥–Ω–∏–π (x1.55)</option>
            </select>
          </div>
          <div class="input-group">
            <label>–¢–µ–º–ø —Ü–µ–ª–∏ (–≤ –Ω–µ–¥–µ–ª—é)</label>
            <select [(ngModel)]="user.weeklyGoalKg">
              <option *ngFor="let g of availableGoals" [ngValue]="g.value">{{ g.label }}</option>
            </select>
          </div>
          <button class="btn-save" (click)="saveProfileData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
      </section>
    </div>
  </div>
</div>